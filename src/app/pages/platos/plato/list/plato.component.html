<app-page-layout [headerTemplate]="headerT" [contentTemplate]="contentT"></app-page-layout>

<!-- HEADER -->
<ng-template #headerT>
  <app-title [titleLabel]="titleLabel" [subtitle]="subTitleLabel" [showBack]="true" variant="tinted" tone="brand"
    (cancel)="goBack()">
    <!-- Botón Nuevo - Solo ADMIN -->
    <ui-button *hasRole="['ADMIN']" [icon]="Plus" label="Nuevo" variant="primary" size="md" [to]="['/platos/nuevo']"></ui-button>
  </app-title>
</ng-template>

<!-- CONTENT -->
<ng-template #contentT>

  <!-- Filtros por Estado -->
  <nav aria-label="Filtros de estado de platos">
    <app-tabs-filter
      [items]="[
        { key:'all',      label:'Todos',     count:counters.all,      tone:'brand'   },
        { key:'active',   label:'Activos',   count:counters.active,   tone:'success' },
        { key:'inactive', label:'Inactivos', count:counters.inactive, tone:'warn'    }
      ]"
      [active]="tab"
      (activeChange)="setTab($any($event))">
    </app-tabs-filter>
  </nav>

  <!-- Búsqueda -->
  <div class="my-4">
    <app-search
      class="w-full max-w-md"
      placeholder="Buscar por nombre o ID"
      [value]="searchForm.controls.q.value"
      (valueChange)="onSearch($event)">
    </app-search>
  </div>

  <!-- Tabla de Platos -->
  <section aria-label="Listado de platos">
    <app-table
      [columns]="columns"
      [rows]="rows"
      [loading]="loading"
      [emptyText]="'No hay platos'"
      [sort]="{ key: sortKey, dir: sortDir }"
      (sortChange)="onSort($event)"
      [actionsTpl]="actionsTpl">

      <!-- Acciones por Fila -->
      <ng-template #actionsTpl let-r>
        <!-- Botón Editar - Solo ADMIN -->
        <ui-button
          *hasRole="['ADMIN']"
          [icon]="Pencil"
          label="Editar"
          variant="primary"
          size="sm"
          [to]="['/platos', r.id, 'editar']"
          [ariaLabel]="'Editar ' + r.nombre">
        </ui-button>

        <!-- Botón Ver Receta - Solo ADMIN -->
        <ui-button
          *hasRole="['ADMIN']"
          [icon]="ChefHat"
          label="Receta"
          variant="outline"
          size="sm"
          [to]="['/platos', r.id, 'receta']"
          [ariaLabel]="'Ver receta de ' + r.nombre">
        </ui-button>
      </ng-template>

    </app-table>
  </section>

  <!-- Paginación -->
  <nav aria-label="Paginación de platos" class="mt-2">
    <app-paginator
      [from]="from()"
      [to]="to()"
      [total]="total"
      [pageIndex]="page"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 20, 30, 50]"
      [maxPage]="maxPage()"
      (sizeChange)="setPageSize($event)"
      (prev)="prev()"
      (next)="next()">
    </app-paginator>
  </nav>

</ng-template>