<!-- 1) Link externo -->
<a *ngIf="href && !to; else routerOrButton" class="btn" [class.icon-only]="iconOnly" [attr.data-variant]="variant"
  [attr.data-size]="size" [style.--btn-icon]="iconPx + 'px'" [href]="href" [target]="target" [attr.rel]="relAttr"
  (click)="onClick($event)" [attr.aria-label]="computedAriaLabel" [attr.title]="computedTitle"
  [attr.aria-disabled]="(disabled || loading) ? 'true' : null" [attr.aria-busy]="loading ? 'true' : null"
  [attr.aria-expanded]="ariaExpanded === null ? null : ariaExpanded" [attr.tabindex]="(disabled || loading) ? -1 : null"
  [attr.data-testid]="dataTestId || null">

  <ng-container *ngIf="iconOnly; else withText">
    <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
  </ng-container>

  <ng-template #withText>
    <ng-container *ngIf="!trailingIcon">
      <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
    </ng-container>
    <span [class.hidden]="responsiveText" class="sm:inline">{{ label }}</span>
    <ng-container *ngIf="trailingIcon">
      <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
    </ng-container>
  </ng-template>
</a>

<!-- 2) RouterLink o 3) Button -->
<ng-template #routerOrButton>
  <!-- RouterLink -->
  <a *ngIf="to; else plainButton" class="btn" [class.icon-only]="iconOnly" [attr.data-variant]="variant"
    [attr.data-size]="size" [style.--btn-icon]="iconPx + 'px'" [routerLink]="to" (click)="onClick($event)"
    [attr.aria-label]="computedAriaLabel" [attr.title]="computedTitle"
    [attr.aria-disabled]="(disabled || loading) ? 'true' : null" [attr.aria-busy]="loading ? 'true' : null"
    [attr.aria-expanded]="ariaExpanded === null ? null : ariaExpanded"
    [attr.tabindex]="(disabled || loading) ? -1 : null" [attr.data-testid]="dataTestId || null">

    <ng-container *ngIf="iconOnly; else withText2">
      <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
    </ng-container>
    <ng-template #withText2>
      <ng-container *ngIf="!trailingIcon">
        <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
      </ng-container>
      <span [class.hidden]="responsiveText" class="sm:inline">{{ label }}</span>
      <ng-container *ngIf="trailingIcon">
        <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
      </ng-container>
    </ng-template>
  </a>

  <!-- BotÃ³n nativo -->
  <ng-template #plainButton>
    <button class="btn" [class.icon-only]="iconOnly" [attr.data-variant]="variant" [attr.data-size]="size"
      [style.--btn-icon]="iconPx + 'px'" [type]="type" (click)="onClick($event)" [disabled]="disabled || loading"
      [attr.aria-busy]="loading ? 'true' : null" [attr.aria-label]="computedAriaLabel" [attr.title]="computedTitle"
      [attr.aria-expanded]="ariaExpanded === null ? null : ariaExpanded" [attr.data-testid]="dataTestId || null">

      <ng-container *ngIf="iconOnly; else withText3">
        <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
      </ng-container>
      <ng-template #withText3>
        <ng-container *ngIf="!trailingIcon">
          <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
        </ng-container>
        <span [class.hidden]="responsiveText" class="sm:inline">{{ label }}</span>
        <ng-container *ngIf="trailingIcon">
          <lucide-icon *ngIf="icon" [img]="icon" [size]="iconPx" aria-hidden="true"></lucide-icon>
        </ng-container>
      </ng-template>
    </button>
  </ng-template>
</ng-template>